  <!doctype html>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="description" content="The next step for Bernie Sanders' movement is a new group called Our Revolution, which will fight to transform America and advance the progressive agenda that we believe in. Get started by hosting an event today and let's continue this political revolution.">
<meta property="og:image" content="http://map.ourrevolution.com/img/map-v-2.png" />
<meta property="og:url" content="http://map.ourrevolution.com/" />
<meta property="og:title" content="Let's Organize and Continue this Political Revolution"/>
<meta property="og:description" content="The next step for Bernie Sanders' movement is a new group called Our Revolution, which will fight to transform America and advance the progressive agenda that we believe in. Get started by hosting an event today and let's continue this political revolution."/>
<link href='//api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css' rel='stylesheet' />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@OurRevolution">
<meta name="twitter:creator" content="@OurRevolution">
<meta name="twitter:title" content="Let's Organize and Continue this Political Revolution">
<meta name="twitter:description" content="The next step for Bernie Sanders' movement is a new group called Our Revolution, which will fight to transform America and advance the progressive agenda that we believe in. Get started by hosting an event today and let's continue this political revolution.">
<meta name="twitter:image" content="http://map.ourrevolution.com/img/map-v-2.png">

<link rel="stylesheet" type="text/css" href="./css/events-map.css">
<link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Merriweather:400,900,700' />
<link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Lato:100,900,700,400,300' />
<title>Legen Wir los und machen Veranstaltungen für eine soziale Republik</title>

<!--[if lte IE 9]>
       <meta http-equiv="refresh" content="0; url=https://jetzt.aufstehen.de/page/event/search_simple" />
     <![endif]-->
<body class='list-view initial-view'>
<section id='header'>
<div id="header" class='lato'>

  <div class="main-title-area">
    <div id="header-container">
      <div id="logo-area">
      <svg width="200" height="100">
                <image xlink:href="//aufstehen.de/wp-content/themes/derneueweg-child/img/brand-new.svg" width="200" height="70"
                  x="0"
                />
            </svg>
        
      </div>
   
    </div>
  </div>

  <nav>
    <ul id="nav">
       <span id="cta-spiel"><strong>BETA-TEST</strong> — Teste die Karte</span>
      <li>
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://map.aufstehen.de/" data-text="Ich stehe auf ! finde auch Du Veranstaltungen in Deiner Nähe" data-related="BernieSanders" data-count="none">Tweet</a>&nbsp;&nbsp;<div class="fb-share-button" data-href="http://map.ourrevolution.com/" data-layout="button">
        <a href="javascript:fbShare('http://map.aufstehen.de/', 'Fb Share', 'Facebook share popup', 'http://map.ourrevolution.com/img/map-v-2.png', 520, 350)"><img src='./img/icon/fb.png' /><span>Share</span></a></div>
        <!-- div class="fb-share-button" data-href="http://map.ourrevolution.com/phonebank/" data-layout="button"></div -->
      </li>
      <li><a href="http://machen.aufstehen.io" class="contribute contribute-big" target="_blank">Erstelle eine Veranstaltung</a></li>
    </ul>
  </nav>
  <div style="clear: both"></div>
</div>
</section>
<section id='activity-area' class='clearfix'>
  <article id='events'>
    <div id='filters'>
      <div id='loading-icon' class='lato'>Loading...</div>
      <h3 id='switch-link'>
        <a href='javascript: void(null)' onclick='window.mapManager.toMapView()' id='to-map-view'>Show Map</a>
        <a href='javascript: void(null)' onclick='window.mapManager.toListView()' id='to-list-view'>Show List</a>
      </h3>
      <h4 class='lato title'>
        <span id='screen-title'>Filter</span>
        <span id='mobile-title'>steh mit Uns auf !</span>
      </h4>
      <form id='filter-form'>
        <table>
          <tr>
            <td>
              <h5 class='lato'>Nach Postleitzahl</h5>
              <input type='number' name='zipcode' maxlength='5' placeholder='PLZ' onclick="this.select();" >
            </td>
            <td>
              <h5 class='lato'>Entfernung</h5>
              <select name='distance'>
                <option value='5'>5km</option>
                <option value='20'>20km</option>
                <option value='50' selected='selected'>50km</option>
                <option value='100'>100km</option>
              </select>
            </td>
            <td>
              <h5 class='lato'>Ordnen nach</h5>
              <select name='sort'>
                <option value='time' selected='selected'>Datum</option>
                <option value='distance'>Entfernung</option>
              </select>
              <input type='button' style='position: absolute; z-index: -1; opacity: 0;' id='hidden-button'/>
            </td>
          </tr>
        </table>
        <div id='filter-popup-area' class='lato'>
          <a href='javascript: void(null)' class='filter-button show-filter' onclick='$("#events").addClass("show-type-filter");'>
            Search by Event
          </a>
          <div id='filter-list-area'>
            <h5>Nach Veranstaltungstyp sortieren</h5>
            <div id='f-container'>
              <div id='filter-list-container'>
                <ul id='filter-list'></ul>
              </div>
              <div style='text-align: center; font-size: 11px; margin-top: 10px; color: lightgray;'>
              <a href='javascript: void(null)' id='show-all'
                 onclick='$("#filter-list").find("input[type=checkbox]").prop("checked", true).trigger("change");'>Alles zeigen</a> &bull;
              <a href='javascript: void(null)'
                 onclick='$("#filter-list").find("input[type=checkbox]").prop("checked", false).trigger("change")'>verstecken</a>
              </div>
            </div>
            <p align='right'>
              <a href='javascript: void(null)' class='filter-button'
                 onclick='$("#events").removeClass("show-type-filter");'>
                Legende verstecken
              </a>
            </p>
          </div>
        </div>
      </form>
    </div>
    <div id='event-list-container'>
      <div id='hide-show-office' data-count="0">
        <a href='javascript: void(null)' class='contribute-big show-office' onclick='$("body").addClass("show-office")'>
          <span class='show-offices'>&#8882; Show Nearby Offices (<span id='campaign-off-count'></span>)</span>
        </a>
        <a href='javascript: void(null);' class='contribute-big hide-office' onclick='$("body").removeClass("show-office")'>
          <span class='hide-offices'>&#8883; Hide Offices</span>
        </a>
      </div>
      <ul id='event-list'><li class='mobile-only lato'>Gib Deine <strong>Postleitzahl</strong> ein um Veranstaltungen zu sehen.
      </li></ul>
      <footer>
        

          <sub>&copy; aufstehen | <a href='https://www.aufstehen.de/datenschutz/'>Datenschutz</a></sub>
        </div>

      </footer>
    </div>
  </article>
  <article id='map'>
    <div id='map-container'></div>
  </article>
</section>
<section id='campaign-offices'>
  <div class='viewport'>
    <h3 class='title'>Nearby Campaign Offices</h3>
    <a class='close-button lato' href='javascript: void(null);' onclick='$("body").removeClass("show-office")'>x</a>
    <div class='container'>
      <ul id='campaign-office-list'></ul>
    </div>
  </div>
</section>

<script src="//d1y0otadi3knf6.cloudfront.net/js/jquery.gz"></script>
<script src='//d1y0otadi3knf6.cloudfront.net/js/d3.gz' type='text/javascript'></script>
<script id='zipcodes-datadump' type='text/plain'></script>
<script src='//d1y0otadi3knf6.cloudfront.net/js/deparam.min.gz'></script>
<script src='//d1y0otadi3knf6.cloudfront.net/js/mapbox.gz'></script>
<!-- <script src='/js/leaflet-bouncer.js'></script> -->
<script src='//d1y0otadi3knf6.cloudfront.net/js/moment.min.js'></script>
<script src='./js/js-cookie.js'></script>
<script src='./js/MapManager.js?v=11'></script>
<script type='text/javascript'>
window.eventTypeFilters = [
  {
    name: 'Kennenlerntreffen',
    id:'Kennenlerntreffen',
    onItem: "<span class='map-purple-circle'></span>"
  },
  {
    name: 'Stammtisch',
    id:'Stammtisch',
    onItem: "<span class='map-red-circle'></span>"
  },
  /*{
    name: 'Official Event',
    id: 'official-event',
    onItem: "<span class='map-red-circle'></span>"
  },
  {
    name: 'Phone Bank',
    id: 'phonebank'
  },
  {
    name: 'Volunteer Activity',
    id: 'volunteer'
  },
  {
    name: 'Party Meetings',
    id: 'party-meetings'
  },
  {
    name: 'Rally',
    id: 'rally'
  },*/
  {
    name: 'Veranstaltung',
    id: 'other'
  }
];
</script>
<script type='text/javascript'>
(function($, d3) {
var date = new Date();
$("#loading-icon").show();
$.ajax({
  //url: '//d1y0otadi3knf6.cloudfront.net/js/event-data.gz',
  url: '//aufstehen.io/js/event-data.gz',
  dataType: 'script',
  cache: true, // otherwise will get fresh copy every page load
  success: function(data) {
    d3.csv('//d1y0otadi3knf6.cloudfront.net/d/campaign-offices.csv',
      function(campaignOffices) {
        //Load zipcodes
        //d1y0otadi3knf6.cloudfront.net
        d3.csv('//aufstehen.io/d/us_postal_codes.csv',
         function(zipcodes) {
           $("#loading-icon").hide();
          //Clean data
          window.EVENT_DATA.results.forEach(function(d) {
            d.filters = [];
            //Set filter info
            switch(d.event_type_name) {
              case "Phone Bank" : d.filters.push("phonebank"); break;
              case "Volunteer Activity or Meeting" : d.filters.push("volunteer"); break;
              case "Party Meetings" : d.filters.push("party-meetings"); break;
              case "Kennenlerntreffen" : d.filters.push("Kennenlerntreffen"); break;
              case "Stammtisch" : d.filters.push("Stammtisch"); break;
              case "Rally" : d.filters.push("rally"); break;
              default: d.filters.push('other'); break;
            }

            d.is_official = d.is_official == "1";
            if (d.is_official) { d.filters.push("official-event"); }
          });

          var oldDate = new Date()

          window.EVENT_DATA.results = window.EVENT_DATA.results.concat(
            campaignOffices.map(function(d){
              return {
                filters: d.type == 'office' ? ["campaign-office"] : ["gotv-center"],
                url: "https://maps.google.com?saddr=Current+Location&daddr=" + encodeURIComponent(d.address),
                longitude: d.lon,
                latitude: d.lat,
                name: d.name,
                location: d.address,
                event_type_name: d.type == 'office' ? "Campaign Office" : "GOTV Center",
                capacity: 0,
                id_obfuscated: d.address,
                phone: d.phone,
                is_official: false,
                image: d.type == 'office' ? d.photo : null,
                is_campaign_office: d.type == 'office',
                is_gotv_center: d.type == 'gotv',
                opening_event: d.opening_event == "" ? null : d.opening_event
              };
            })
          );

          /* Extract default lat lon */
          var m = /.*\?c=(.+?),(.+?),(\d+)z#?.*/g.exec(window.location.href)
          if (m && m[1] && m[2] && m[3]) {
            var defaultCoord = {
              center: [parseFloat(m[1]), parseFloat(m[2])],
              zoom: parseInt(m[3])
            };
            window.mapManager = MapManager(window.EVENT_DATA.results, campaignOffices, zipcodes, { defaultCoord: defaultCoord });
            var params = $.deparam
            window.mapManager.filterByCoords(defaultCoord.center, 50, params.sort, params.f);
          } else {
            window.mapManager = MapManager(window.EVENT_DATA.results, campaignOffices, zipcodes);
          }

          if($("input[name='zipcode']").val() == '' && Cookies.get('map.bernie.zipcode') && window.location.hash == '') {
            $("input[name='zipcode']").val(Cookies.get('map.bernie.zipcode'));
            window.location.hash = $("#filter-form").serialize();
          } else {
            $(window).trigger("hashchange");
          }
        });
      }
    );
  }, error: function(a,b,c) {
    console.log("ERROR", b,c);
  }
});

// Registration Data items
d3.csv('./d/registration-data.csv', function(votinginfo) {
  window.votingInfoManager = VotingInfoManager(votinginfo);
})

 /** initial loading before activating listeners...
  */

 var params = $.deparam(window.location.hash.substring(1));
  if (params.zipcode) {
    $("input[name='zipcode']").val(params.zipcode);
  }

  if (params.distance) { $("select[name='distance']").val(params.distance);}
  if (params.sort) { $("select[name='sort']").val(params.sort);}

/* Prepare filters */
$("#filter-list").append(
  window.eventTypeFilters.map(function(d) {
    return $("<li />")
              .append(
                $("<input type='checkbox' class='filter-type' />")
                    .attr('name', 'f[]')
                    .attr("value", d.id)
                    .attr("id", d.id)
                    .prop("checked", !params.f ? true : $.inArray(d.id, params.f) >= 0)
              )
              .append($("<label />").attr('for', d.id).append($("<span />").addClass('filter-on')
                        .append(d.onItem ? d.onItem : $("<span>").addClass('circle-button default-on')))
              .append($("<span />").addClass('filter-off')
                        .append(d.offItem ? d.offItem : $("<span>").addClass('circle-button default-off')))
                        .append($("<span>").text(d.name)));
  })
);
/***
 *  define events
 */
 //only numbers
 $("input[name='zipcode']").on('keyup keydown', function(e) {
  if (e.type == 'keydown' && (e.keyCode < 48 || e.keyCode > 57)
      && e.keyCode != 8 && !(e.keyCode >= 37 || e.keyCode <= 40)) {
    return false;
  }

  if (e.type == 'keyup' && $(this).val().length == 5) {
    if (! (e.keyCode >= 37 && e.keyCode <= 40) ) {
      $(this).closest("form#filter-form").submit();
      $("#hidden-button").focus();
    }
  }
 });

 /***
  *  onchange of select
  */
  $("select[name='distance'],select[name='sort']").on('change', function(e) {
    $(this).closest("form#filter-form").submit();
  });

  /**
  * On filter type change
  */
  $(".filter-type").on('change', function(e) {
    $(this).closest("form#filter-form").submit();
  })

 //On submit
 $("form#filter-form").on('submit', function(e) {
  var serial = $(this).serialize();
  window.location.hash = serial;
  e.preventDefault();
  return false;
 });

 $(window).on('hashchange', function(e) {

  var hash = window.location.hash;
  if (hash.length == 0 || hash.substring(1) == 0) { $("#loading-icon").hide(); return false; }

  var params = $.deparam(hash.substring(1));

  //Custom feature for specific default lat/lon
  //lat=40.7415479&lon=-73.8239609&zoom=17

  setTimeout(function() {
    $("#loading-icon").show();

    if ( window.mapManager._options && window.mapManager._options.defaultCoord && params.zipcode.length != 5) {
      window.mapManager.filterByType(params.f);
      window.mapManager.filterByCoords(window.mapManager._options.defaultCoord.center, params.distance, params.sort, params.f);
    } else {
      window.mapManager.filterByType(params.f);
      window.mapManager.filter(params.zipcode, params.distance, params.sort, params.f);
    }
    $("#loading-icon").hide();

    var $info = window.votingInfoManager.getInfo(window.mapManager._zipcodes[params.zipcode].state);
    $(".registration-msg").remove();
    if ($info) {
      $info.prependTo("#event-list-container");
    }

  }, 10);
  // $("#loading-icon").hide();
  if (params.zipcode.length == 5 && $("body").hasClass("initial-view")) {
    $("#events").removeClass("show-type-filter");
    $("body").removeClass("initial-view");
  }
 });

  var pre = $.deparam(window.location.hash.substring(1));
  if ($("body").hasClass("initial-view")) {
    if ($(window).width() >= 600 && (!pre.zipcode || pre && pre.zipcode.length != 5)) {
      $("#events").addClass("show-type-filter");
    }
  }

  // $('input#state-of-the-revolution-livestream').parent().css('width','100%');

})(jQuery, d3);

</script>

<!-- SOCIAL -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80816425-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script>
  // window.fbAsyncInit = function() {
  //   FB.init({
  //     appId      : '1747464662152148',
  //     xfbml      : true,
  //     version    : 'v2.5'
  //   });
  // };

  // (function(d, s, id){
  //    var js, fjs = d.getElementsByTagName(s)[0];
  //    if (d.getElementById(id)) {return;}
  //    js = d.createElement(s); js.id = id;
  //    js.src = "//connect.facebook.net/en_US/sdk.js";
  //    fjs.parentNode.insertBefore(js, fjs);
  //  }(document, 'script', 'facebook-jssdk'));
</script>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</body>
<script>
    function fbShare(url, title, descr, image, winWidth, winHeight) {
        var winTop = (screen.height / 2) - (winHeight / 2);
        var winLeft = (screen.width / 2) - (winWidth / 2);
        window.open('http://www.facebook.com/sharer.php?s=100&p[title]=' + title + '&p[summary]=' + descr + '&p[url]=' + url + '&p[images][0]=' + image, 'sharer', 'top=' + winTop + ',left=' + winLeft + ',toolbar=0,status=0,width=' + winWidth + ',height=' + winHeight);
    }
</script>
